
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Vllm Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-back-to-top-button/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-chapter-fold/chapter-fold.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-code/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-splitter/splitter.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-katex/katex.min.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-expandable-chapters-small/expandable-chapters-small.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="../OSDI 2022/" />
    
    
    <link rel="prev" href="./" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        <li class="header">Preface</li>
        
        
    
        <li class="chapter " data-level="1.1" data-path="../../">
            
                <a href="../../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Blogs</li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="../../Blogs/Academic Writing/">
            
                <a href="../../Blogs/Academic Writing/">
            
                    
                    Academic Writing
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1.1" data-path="../../Blogs/Academic Writing/design of system.html">
            
                <a href="../../Blogs/Academic Writing/design of system.html">
            
                    
                    Design Of System
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="../../Blogs/academic reading.html">
            
                <a href="../../Blogs/academic reading.html">
            
                    
                    Academic Reading
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="../../Blogs/how to express.html">
            
                <a href="../../Blogs/how to express.html">
            
                    
                    How To Express
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Paper Reading Notes</li>
        
        
    
        <li class="chapter " data-level="3.1" data-path="../Arxiv/">
            
                <a href="../Arxiv/">
            
                    
                    Arxiv
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1.1" data-path="../Arxiv/Mooncake.html">
            
                <a href="../Arxiv/Mooncake.html">
            
                    
                    Mooncake
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.2" data-path="../Arxiv/S-LoRA.html">
            
                <a href="../Arxiv/S-LoRA.html">
            
                    
                    S-LoRA
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.3" data-path="../Arxiv/MemServe.md">
            
                <span>
            
                    
                    MemServe
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.2" data-path="../ASPLOS 2024/">
            
                <a href="../ASPLOS 2024/">
            
                    
                    ASPLOS 2024
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.2.1" data-path="../ASPLOS 2024/ExeGPT.html">
            
                <a href="../ASPLOS 2024/ExeGPT.html">
            
                    
                    Exe GPT
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2.2" data-path="../ASPLOS 2024/SpecInfer.html">
            
                <a href="../ASPLOS 2024/SpecInfer.html">
            
                    
                    Spec Infer
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.3" data-path="../OSDI 2024/">
            
                <a href="../OSDI 2024/">
            
                    
                    OSDI 2024
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.3.1" data-path="../OSDI 2024/Llumnix.html">
            
                <a href="../OSDI 2024/Llumnix.html">
            
                    
                    Llumnix
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3.2" data-path="../OSDI 2024/ServerlessLLM.html">
            
                <a href="../OSDI 2024/ServerlessLLM.html">
            
                    
                    Serverless LLM
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3.3" data-path="../OSDI 2024/Fairness in Serving LLM.md">
            
                <span>
            
                    
                    Fairness in Serving LLM
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.4" data-path="../SOSP 2024/">
            
                <a href="../SOSP 2024/">
            
                    
                    SOSP 2024
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.4.1" data-path="../SOSP 2024/Apparate.html">
            
                <a href="../SOSP 2024/Apparate.html">
            
                    
                    Apparate
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.4.2" data-path="../SOSP 2024/LoongServe.html">
            
                <a href="../SOSP 2024/LoongServe.html">
            
                    
                    Loong Serve
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.5" data-path="../FAST 2023/">
            
                <a href="../FAST 2023/">
            
                    
                    FAST 2023
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.5.1" data-path="../FAST 2023/Resource Scheduling for LC Services.html">
            
                <a href="../FAST 2023/Resource Scheduling for LC Services.html">
            
                    
                    Resource Scheduling For LC Services
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.6" data-path="../ICML 2023/">
            
                <a href="../ICML 2023/">
            
                    
                    ICML 2023
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.6.1" data-path="../ICML 2023/FlexGen.html">
            
                <a href="../ICML 2023/FlexGen.html">
            
                    
                    Flex Gen
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.7" data-path="../NSDI 2023/">
            
                <a href="../NSDI 2023/">
            
                    
                    NSDI 2023
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.7.1" data-path="../NSDI 2023/Shockwave.html">
            
                <a href="../NSDI 2023/Shockwave.html">
            
                    
                    Shockwave
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.8" data-path="../SC 2023/">
            
                <a href="../SC 2023/">
            
                    
                    SC 2023
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.8.1" data-path="../SC 2023/AutoMap.html">
            
                <a href="../SC 2023/AutoMap.html">
            
                    
                    Auto Map
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.9" data-path="./">
            
                <a href="./">
            
                    
                    SOSP 2023
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter active" data-level="3.9.1" data-path="vllm.html">
            
                <a href="vllm.html">
            
                    
                    Vllm
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.10" data-path="../OSDI 2022/">
            
                <a href="../OSDI 2022/">
            
                    
                    OSDI 2022
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.10.1" data-path="../OSDI 2022/Orca.html">
            
                <a href="../OSDI 2022/Orca.html">
            
                    
                    Orca
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.11" data-path="../SC 2022/">
            
                <a href="../SC 2022/">
            
                    
                    SC 2022
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.11.1" data-path="../SC 2022/CoGNN.html">
            
                <a href="../SC 2022/CoGNN.html">
            
                    
                    Co GNN
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.11.2" data-path="../SC 2022/VSGM.html">
            
                <a href="../SC 2022/VSGM.html">
            
                    
                    VSGM
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.12" data-path="../OSDI 2020/">
            
                <a href="../OSDI 2020/">
            
                    
                    OSDI 2020
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.12.1" data-path="../OSDI 2020/Gavel.html">
            
                <a href="../OSDI 2020/Gavel.html">
            
                    
                    Gavel
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.13" data-path="../SIGMOD 2020/">
            
                <a href="../SIGMOD 2020/">
            
                    
                    SIGMOD 2020
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.13.1" data-path="../SIGMOD 2020/GPU-based Subgraph Enumerations.html">
            
                <a href="../SIGMOD 2020/GPU-based Subgraph Enumerations.html">
            
                    
                    GPU Based Subgraph Enumerations
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.14" data-path="../OSDI 2018/">
            
                <a href="../OSDI 2018/">
            
                    
                    OSDI 2018
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.14.1" data-path="../OSDI 2018/Ray.html">
            
                <a href="../OSDI 2018/Ray.html">
            
                    
                    Ray
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="header">Study Notes</li>
        
        
    
        <li class="chapter " data-level="4.1" data-path="../../Study Notes/CME 213/">
            
                <a href="../../Study Notes/CME 213/">
            
                    
                    CME 213
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1.1" data-path="../../Study Notes/CME 213/C++.html">
            
                <a href="../../Study Notes/CME 213/C++.html">
            
                    
                    C
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.2" data-path="../../Study Notes/CUDA/">
            
                <a href="../../Study Notes/CUDA/">
            
                    
                    CUDA
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.2.1" data-path="../../Study Notes/CUDA/CUDA Warp Level.html">
            
                <a href="../../Study Notes/CUDA/CUDA Warp Level.html">
            
                    
                    CUDA Warp Level
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.2.2" data-path="../../Study Notes/CUDA/CUDA1 Basic.html">
            
                <a href="../../Study Notes/CUDA/CUDA1 Basic.html">
            
                    
                    CUDA 1 Basic
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.2.3" data-path="../../Study Notes/CUDA/CUDA2 Brief Summary.html">
            
                <a href="../../Study Notes/CUDA/CUDA2 Brief Summary.html">
            
                    
                    CUDA 2 Brief Summary
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.2.4" data-path="../../Study Notes/CUDA/CUDA3 Kernels.html">
            
                <a href="../../Study Notes/CUDA/CUDA3 Kernels.html">
            
                    
                    CUDA 3 Kernels
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.2.5" data-path="../../Study Notes/CUDA/Nsight System.html">
            
                <a href="../../Study Notes/CUDA/Nsight System.html">
            
                    
                    Nsight System
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.3" data-path="../../Study Notes/LLM Parallelism/">
            
                <a href="../../Study Notes/LLM Parallelism/">
            
                    
                    LLM Parallelism
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.3.1" data-path="../../Study Notes/LLM Parallelism/Data Parallelism.html">
            
                <a href="../../Study Notes/LLM Parallelism/Data Parallelism.html">
            
                    
                    Data Parallelism
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.3.2" data-path="../../Study Notes/LLM Parallelism/Pipe Parallelism.html">
            
                <a href="../../Study Notes/LLM Parallelism/Pipe Parallelism.html">
            
                    
                    Pipe Parallelism
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.3.3" data-path="../../Study Notes/LLM Parallelism/Tensor Parallelism.html">
            
                <a href="../../Study Notes/LLM Parallelism/Tensor Parallelism.html">
            
                    
                    Tensor Parallelism
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.4" data-path="../../Study Notes/MIT 6.172/">
            
                <a href="../../Study Notes/MIT 6.172/">
            
                    
                    MIT 6.172
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.4.1" data-path="../../Study Notes/MIT 6.172/mit-6-172-1.html">
            
                <a href="../../Study Notes/MIT 6.172/mit-6-172-1.html">
            
                    
                    Mit 6 172 1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.4.2" data-path="../../Study Notes/MIT 6.172/mit-6-172-12.html">
            
                <a href="../../Study Notes/MIT 6.172/mit-6-172-12.html">
            
                    
                    Mit 6 172 12
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.4.3" data-path="../../Study Notes/MIT 6.172/mit-6-172-2.html">
            
                <a href="../../Study Notes/MIT 6.172/mit-6-172-2.html">
            
                    
                    Mit 6 172 2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.4.4" data-path="../../Study Notes/MIT 6.172/mit-6-172-3.html">
            
                <a href="../../Study Notes/MIT 6.172/mit-6-172-3.html">
            
                    
                    Mit 6 172 3
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.4.5" data-path="../../Study Notes/MIT 6.172/mit-6-172-hw2.html">
            
                <a href="../../Study Notes/MIT 6.172/mit-6-172-hw2.html">
            
                    
                    Mit 6 172 Hw 2
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.5" data-path="../../Study Notes/MLSYS/">
            
                <a href="../../Study Notes/MLSYS/">
            
                    
                    MLSYS
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.5.1" data-path="../../Study Notes/MLSYS/Llama Model's Decoder Code.html">
            
                <a href="../../Study Notes/MLSYS/Llama Model's Decoder Code.html">
            
                    
                    Llama Model S Decoder Code
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.5.2" data-path="../../Study Notes/MLSYS/LLM Calculation.html">
            
                <a href="../../Study Notes/MLSYS/LLM Calculation.html">
            
                    
                    LLM Calculation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.5.3" data-path="../../Study Notes/MLSYS/LLM Deployment Record.html">
            
                <a href="../../Study Notes/MLSYS/LLM Deployment Record.html">
            
                    
                    LLM Deployment Record
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.5.4" data-path="../../Study Notes/MLSYS/Sepculative Decoding.html">
            
                <a href="../../Study Notes/MLSYS/Sepculative Decoding.html">
            
                    
                    Sepculative Decoding
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.6" data-path="../../Study Notes/NLP/">
            
                <a href="../../Study Notes/NLP/">
            
                    
                    NLP
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.6.1" data-path="../../Study Notes/NLP/Basics of Machine Learning.html">
            
                <a href="../../Study Notes/NLP/Basics of Machine Learning.html">
            
                    
                    Basics Of Machine Learning
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.6.2" data-path="../../Study Notes/NLP/GPT.html">
            
                <a href="../../Study Notes/NLP/GPT.html">
            
                    
                    GPT
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.6.3" data-path="../../Study Notes/NLP/Implementation Neural Network.html">
            
                <a href="../../Study Notes/NLP/Implementation Neural Network.html">
            
                    
                    Implementation Neural Network
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.6.4" data-path="../../Study Notes/NLP/Loss Function.html">
            
                <a href="../../Study Notes/NLP/Loss Function.html">
            
                    
                    Loss Function
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.6.5" data-path="../../Study Notes/NLP/Recurrent Neural Network.html">
            
                <a href="../../Study Notes/NLP/Recurrent Neural Network.html">
            
                    
                    Recurrent Neural Network
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.6.6" data-path="../../Study Notes/NLP/Seq2Seq and Attention.html">
            
                <a href="../../Study Notes/NLP/Seq2Seq and Attention.html">
            
                    
                    Seq 2 Seq And Attention
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.7" data-path="../../Study Notes/OPENMP/">
            
                <a href="../../Study Notes/OPENMP/">
            
                    
                    OPENMP
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.7.1" data-path="../../Study Notes/OPENMP/openmp.html">
            
                <a href="../../Study Notes/OPENMP/openmp.html">
            
                    
                    OPENMP
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.8" data-path="../../Study Notes/Triton/">
            
                <a href="../../Study Notes/Triton/">
            
                    
                    Triton
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.9" data-path="../../Study Notes/Ray/index.md">
            
                <span>
            
                    
                    Ray
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.10" data-path="../../Study Notes/vLLM Code/">
            
                <a href="../../Study Notes/vLLM Code/">
            
                    
                    VLLM Code
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.10.1" data-path="../../Study Notes/vLLM Code/vllm-async-llm.html">
            
                <a href="../../Study Notes/vLLM Code/vllm-async-llm.html">
            
                    
                    Vllm Async Llm
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.10.2" data-path="../../Study Notes/vLLM Code/vllm-attention.html">
            
                <a href="../../Study Notes/vLLM Code/vllm-attention.html">
            
                    
                    Vllm Attention
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.10.3" data-path="../../Study Notes/vLLM Code/vllm-block.html">
            
                <a href="../../Study Notes/vLLM Code/vllm-block.html">
            
                    
                    Vllm Block
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.10.4" data-path="../../Study Notes/vLLM Code/vllm-cache.html">
            
                <a href="../../Study Notes/vLLM Code/vllm-cache.html">
            
                    
                    Vllm Cache
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.10.5" data-path="../../Study Notes/vLLM Code/vllm-chunked-prefill.html">
            
                <a href="../../Study Notes/vLLM Code/vllm-chunked-prefill.html">
            
                    
                    Vllm Chunked Prefill
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.10.6" data-path="../../Study Notes/vLLM Code/vllm-cpu.html">
            
                <a href="../../Study Notes/vLLM Code/vllm-cpu.html">
            
                    
                    Vllm Cpu
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.10.7" data-path="../../Study Notes/vLLM Code/vllm-llama.html">
            
                <a href="../../Study Notes/vLLM Code/vllm-llama.html">
            
                    
                    Vllm Llama
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.10.8" data-path="../../Study Notes/vLLM Code/vllm-LoRA.html">
            
                <a href="../../Study Notes/vLLM Code/vllm-LoRA.html">
            
                    
                    Vllm Lo RA
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.10.9" data-path="../../Study Notes/vLLM Code/vllm-metadata.html">
            
                <a href="../../Study Notes/vLLM Code/vllm-metadata.html">
            
                    
                    Vllm Metadata
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.10.10" data-path="../../Study Notes/vLLM Code/vllm-profile.html">
            
                <a href="../../Study Notes/vLLM Code/vllm-profile.html">
            
                    
                    Vllm Profile
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.10.11" data-path="../../Study Notes/vLLM Code/vllm-ray.html">
            
                <a href="../../Study Notes/vLLM Code/vllm-ray.html">
            
                    
                    Vllm Ray
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.10.12" data-path="../../Study Notes/vLLM Code/vllm-schedule.html">
            
                <a href="../../Study Notes/vLLM Code/vllm-schedule.html">
            
                    
                    Vllm Schedule
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.11" data-path="../../Study Notes/Llumnix Code/">
            
                <a href="../../Study Notes/Llumnix Code/">
            
                    
                    Llumnix Code
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.11.1" data-path="../../Study Notes/Llumnix Code/llumnix.html">
            
                <a href="../../Study Notes/Llumnix Code/llumnix.html">
            
                    
                    Llumnix
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.12" data-path="../../Study Notes/LoongServe Code/">
            
                <a href="../../Study Notes/LoongServe Code/">
            
                    
                    LoongServe Code
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../.." >Vllm</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="efficient-memory-management-for-large-language-model-serving-with-pagedattention"><a href="https://arxiv.org/abs/2309.06180" target="_blank">Efficient Memory Management for Large Language Model Serving with PagedAttention</a></h1>
<h2 id="&#x9884;&#x5907;&#x77E5;&#x8BC6;">&#x9884;&#x5907;&#x77E5;&#x8BC6;</h2>
<h3 id="transformer&#x7684;self-attention-layers">transformer&#x7684;self-attention layers</h3>
<blockquote>
<p>For an input hidden state sequence $(&#x1D465;1, . . . , &#x1D465;&#x1D45B;) &#x2208; R^{&#x1D45B;&#xD7;&#x1D451;}$ , a self-attention layer first applies linear transformations on each position &#x1D456; to get the query, key, and value vectors:</p>
<p><img src="vllm.assets/5.png" alt="5"></p>
<p>Then, the self-attention layer computes the attention score $&#x1D44E;<em>{&#x1D456; &#x1D457;}$ by multiplying the query vector at one position with all the key vectors before it and compute the output $&#x1D45C;</em>&#x1D456;$ as the weighted average over the value vectors:</p>
<p><img src="vllm.assets/6.png" alt="6"></p>
</blockquote>
<p>&#x7B80;&#x800C;&#x8A00;&#x4E4B;&#xFF0C;&#x5148;&#x628A;&#x6BCF;&#x4E2A;&#x4F4D;&#x7F6E;&#x7684;&#x8BCD;&#x7B97;&#x51FA;&#x5176;q k v&#xFF0C;&#x7136;&#x540E;&#x7528;&#x6CE8;&#x610F;&#x529B;&#x516C;&#x5F0F;&#x7B97;&#x51FA;&#x6BCF;&#x4E24;&#x4E2A;&#x8BCD;&#x4E4B;&#x95F4;&#x7684;a&#x548C;&#x6BCF;&#x4E2A;&#x8BCD;&#x7684;o&#x3002;</p>
<p>&#x9664;&#x6B64;&#x4E4B;&#x5916;&#xFF0C;transformer including the embedding layer, feed-forward layer, layer normalization, residual connection, output logit computation, and the query, key, and value transformation.</p>
<h3 id="kv-cache">KV Cache</h3>
<blockquote>
<p>&#x4EE5;GPT&#x4E3A;&#x4EE3;&#x8868;&#x7684;Decoder-Only&#x81EA;&#x56DE;&#x5F52;&#x8BED;&#x8A00;&#x6A21;&#x578B;&#x5728;&#x751F;&#x6210;&#x6BCF;&#x4E00;&#x4E2A;&#x65B0;&#x7684; token &#x65F6;&#xFF0C;&#x63A5;&#x53D7;&#x6240;&#x6709;&#x4E4B;&#x524D;&#x751F;&#x6210;&#x7684; tokens &#x4F5C;&#x4E3A;&#x8F93;&#x5165;&#x3002;&#x7136;&#x800C;&#xFF0C;&#x5BF9;&#x4E8E;&#x8FD9;&#x4E9B;&#x5148;&#x524D;&#x751F;&#x6210;&#x7684; tokens&#xFF0C;&#x6BCF;&#x6B21;&#x751F;&#x6210;&#x65B0;&#x7684; token &#x65F6;&#x90FD;&#x9700;&#x8981;&#x91CD;&#x65B0;&#x8BA1;&#x7B97;&#x4ED6;&#x4EEC;&#x7684;&#x8868;&#x793A;&#xFF0C;&#x8FD9;&#x4E2A;&#x8FC7;&#x7A0B;&#x9020;&#x6210;&#x4E86;&#x5927;&#x91CF;&#x7684;&#x8BA1;&#x7B97;&#x6D6A;&#x8D39;&#x3002;KV Cache &#x7684;&#x5F15;&#x5165;&#x5C31;&#x662F;&#x4E3A;&#x4E86;&#x89E3;&#x51B3;&#x8FD9;&#x4E2A;&#x95EE;&#x9898;&#x3002;</p>
<p>KV Cache&#x5B9E;&#x8D28;&#x4E0A;&#x662F;&#x5B58;&#x50A8;&#x4E86;&#x4E4B;&#x524D;&#x8BA1;&#x7B97;&#x8FC7;&#x7684; key-value &#x5BF9;&#x7528;&#x4E8E;&#x4E0B;&#x4E00;&#x4E2A;Token&#x7684;&#x751F;&#x6210;&#x3002;&#x5728; Transformer &#x7ED3;&#x6784;&#x4E2D;&#xFF0C;self-attention &#x4E2D;&#x7684;k_proj, v_proj&#x4F1A;&#x5C06;&#x8F93;&#x5165;&#x7684;&#x6BCF;&#x4E2A; token &#x8F6C;&#x5316;&#x4E3A;&#x4E00;&#x4E2A; key &#x548C;&#x4E00;&#x4E2A; value&#xFF0C;&#x7136;&#x540E;&#x4F7F;&#x7528;&#x8FD9;&#x4E9B; key-value &#x4EE5;&#x53CA;&#x5F53;&#x524D;&#x7684;query&#x5BF9;&#x6765;&#x8BA1;&#x7B97;&#x4E0B;&#x4E00;&#x4E2A; token&#x3002;&#x5F15;&#x5165; KV Cache&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x5C06;&#x4E4B;&#x524D;&#x751F;&#x6210;&#x7684; tokens &#x5BF9;&#x5E94;&#x7684; key-value &#x5BF9;&#x5B58;&#x50A8;&#x8D77;&#x6765;&#xFF0C;&#x5F53;&#x751F;&#x6210;&#x65B0;&#x7684; token &#x65F6;&#xFF0C;<strong>&#x76F4;&#x63A5;&#x4ECE; KV Cache &#x4E2D;&#x53D6;&#x51FA;&#x8FD9;&#x4E9B;&#x5DF2;&#x7ECF;&#x8BA1;&#x7B97;&#x597D;&#x7684; key-value &#x5BF9;&#xFF0C;&#x518D;&#x628A;&#x5F53;&#x524D;token&#x7684;key-value&#x505A;&#x4E00;&#x4E2A;&#x8FDE;&#x7ED3;&#x5728;&#x8FDB;&#x884C;&#x8BA1;&#x7B97;</strong>&#xFF0C;&#x8FD9;&#x6837;&#x5C31;&#x907F;&#x514D;&#x4E86;KV&#x7684;&#x91CD;&#x590D;&#x8BA1;&#x7B97;&#xFF0C;&#x5927;&#x5927;&#x63D0;&#x9AD8;&#x4E86;&#x8BA1;&#x7B97;&#x6548;&#x7387;&#x3002;</p>
</blockquote>
<p>KV Cache&#x5305;&#x542B;&#x4EE5;&#x4E0B;&#x6B65;&#x9AA4;</p>
<blockquote>
<p><strong>&#x9884;&#x586B;&#x5145;&#x9636;&#x6BB5;</strong>&#xFF1A;&#x5728;&#x8BA1;&#x7B97;&#x7B2C;&#x4E00;&#x4E2A;&#x8F93;&#x51FA;token&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x6B64;&#x65F6;Cache&#x662F;&#x7A7A;&#x7684;&#xFF0C;&#x8BA1;&#x7B97;&#x65F6;&#x9700;&#x8981;&#x4E3A;&#x6BCF;&#x4E2A; transformer layer &#x8BA1;&#x7B97;&#x5E76;&#x4FDD;&#x5B58;key cache&#x548C;value cache&#xFF0C;&#x5728;&#x8F93;&#x51FA;token&#x65F6;Cache&#x5B8C;&#x6210;&#x586B;&#x5145;&#xFF1B;FLOPs&#x540C;KV Cache&#x5173;&#x95ED;&#x4E00;&#x81F4;&#xFF0C;&#x5B58;&#x5728;&#x5927;&#x91CF;gemm&#x64CD;&#x4F5C;&#xFF0C;&#x63A8;&#x7406;&#x901F;&#x5EA6;&#x6162;&#xFF0C;&#x8FD9;&#x65F6;&#x5C5E;&#x4E8E;Compute-bound&#x7C7B;&#x578B;&#x8BA1;&#x7B97;&#x3002;</p>
<p><strong>KV Cache&#x9636;&#x6BB5;</strong>&#xFF1A;&#x5728;&#x8BA1;&#x7B97;&#x7B2C;&#x4E8C;&#x4E2A;&#x8F93;&#x51FA;token&#x81F3;&#x6700;&#x540E;&#x4E00;&#x4E2A;token&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x6B64;&#x65F6;Cache&#x662F;&#x6709;&#x503C;&#x7684;&#xFF0C;&#x6BCF;&#x8F6E;&#x63A8;&#x7406;&#x53EA;&#x9700;&#x8BFB;&#x53D6;Cache&#xFF0C;&#x540C;&#x65F6;&#x5C06;&#x5F53;&#x524D;&#x8F6E;&#x8BA1;&#x7B97;&#x51FA;&#x7684;&#x65B0;&#x7684;Key&#x3001;Value&#x8FFD;&#x52A0;&#x5199;&#x5165;&#x81F3;Cache&#xFF1B;FLOPs&#x964D;&#x4F4E;&#xFF0C;gemm&#x53D8;&#x4E3A;gemv&#x64CD;&#x4F5C;&#xFF0C;&#x63A8;&#x7406;&#x901F;&#x5EA6;&#x76F8;&#x5BF9;&#x7B2C;&#x4E00;&#x9636;&#x6BB5;&#x53D8;&#x5FEB;&#xFF0C;&#x8FD9;&#x65F6;&#x5C5E;&#x4E8E;Memory-bound&#x7C7B;&#x578B;&#x8BA1;&#x7B97;&#x3002;</p>
<p>&#x65E0;KV Cache&#x751F;&#x6210;&#x793A;&#x4F8B;</p>
<p><img src="vllm.assets/3.png" alt="3"></p>
<p>KV Cache&#x751F;&#x6210;&#x793A;&#x4F8B;</p>
<p><img src="vllm.assets/4.png" alt="4"></p>
</blockquote>
<p>&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;&#x4F7F;&#x7528;&#x4E86;KV Cache&#x8282;&#x7701;&#x4E86;&#x5927;&#x91CF;&#x7684;&#x91CD;&#x590D;&#x8BA1;&#x7B97;&#x3002;</p>
<h3 id="&#x5F53;&#x524D;batching-techniques-for-llms">&#x5F53;&#x524D;Batching Techniques for LLMs</h3>
<p>&#x56F0;&#x5883;&#xFF1A;</p>
<ul>
<li>&#x8BF7;&#x6C42;&#x53EF;&#x80FD;&#x5728;&#x4E0D;&#x540C;&#x65F6;&#x95F4;&#x6BB5;&#x5230;&#x8FBE;</li>
<li>&#x8BF7;&#x6C42;&#x5E8F;&#x5217;&#x7684;&#x957F;&#x5EA6;&#x4E0D;&#x540C;</li>
</ul>
<p>&#x76EE;&#x524D;&#x65B9;&#x6CD5;&#xFF1A;</p>
<ul>
<li>&#x91C7;&#x7528;&#x7EC6;&#x7C92;&#x5EA6;&#x7684;&#x6279;&#x5904;&#x7406;&#x673A;&#x5236;</li>
</ul>
<h3 id="memory-challenges-in-llm-serving">Memory Challenges in LLM Serving</h3>
<p>&#x6311;&#x6218;&#xFF1A;</p>
<ul>
<li>KV cache&#x592A;&#x5927;&#x4E86;&#xFF0C;&#x4E14;GPU&#x7684;&#x8BA1;&#x7B97;&#x80FD;&#x529B;&#x4F1A;&#x6BD4;&#x5176;&#x5185;&#x5B58;&#x589E;&#x957F;&#x5F97;&#x66F4;&#x5FEB;&#x3002;</li>
<li>decoding&#x7B97;&#x6CD5;&#x8D8A;&#x6765;&#x8D8A;&#x590D;&#x6742;&#xFF0C;&#x5982;&#x4F55;&#x9002;&#x914D;&#x3002;</li>
<li>&#x8F93;&#x5165;&#x8F93;&#x51FA;&#x957F;&#x5EA6;&#x4E0D;&#x540C;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x5982;&#x4F55;&#x8C03;&#x5EA6;&#x8D44;&#x6E90;&#x3002;</li>
</ul>
<h2 id="vllm">vLLM</h2>
<h3 id="&#x6548;&#x679C;">&#x6548;&#x679C;</h3>
<p><strong>&#x6548;&#x679C;</strong>&#xFF1A;</p>
<blockquote>
<p> PagedAttention, an attention algorithm inspired by the classical <strong>virtual memory</strong> and <strong>paging techniques</strong> in operating systems</p>
</blockquote>
<p>&#x60F3;&#x6CD5;&#x6765;&#x6E90;&#x4E8E;&#x865A;&#x62DF;&#x5185;&#x5B58;&#x548C;&#x5206;&#x9875;&#x6280;&#x672F;</p>
<blockquote>
<p>vLLM, an LLM serving system that achieves (1) <strong>near-zero waste</strong> in KV cache memory and (2) <strong>flexible sharing of KV cache</strong> within and across requests to further reduce memory usage.</p>
<p><img src="vllm.assets/1.png" alt="1"></p>
</blockquote>
<p>&#x5DE6;&#x56FE;&#x5C31;&#x662F;vLLM&#x5C06;KV Cache&#x63A7;&#x5236;&#x5728;&#x7EA2;&#x8272;&#xFF0C;&#x4E14;&#x7528;&#x4E00;&#x90E8;&#x5206;&#x9EC4;&#x8272;&#x8FDB;&#x884C;&#x6FC0;&#x6D3B;&#x3002;&#x6240;&#x4EE5;&#x968F;&#x7740;&#x89C4;&#x6A21;&#x6269;&#x5927;&#xFF0C;vLLM&#x7684;&#x5185;&#x5B58;&#x4F7F;&#x7528;&#x91CF;&#x53EF;&#x4EE5;&#x63A7;&#x5236;&#x5F97;&#x66F4;&#x597D;&#x3002;&#x6B63;&#x5982;&#x53F3;&#x56FE;&#x6240;&#x793A;&#x3002;</p>
<blockquote>
<p><img src="vllm.assets/2.png" alt="2"></p>
</blockquote>
<p>&#x5185;&#x5B58;&#x8D44;&#x6E90;&#x6D6A;&#x8D39;&#x5E73;&#x5747;&#x767E;&#x5206;&#x6BD4;&#x56FE;&#xFF0C;&#x53EF;&#x4EE5;&#x770B;&#x5230;vLLM&#x7684;&#x6709;&#x6548;&#x6027;&#x3002;</p>
<h3 id="pagedattention">PagedAttention</h3>
<p><strong>&#x7279;&#x8272;&#xFF1A;</strong>&#x5141;&#x8BB8;&#x4E0D;&#x8FDE;&#x7EED;&#x7684;KV cache&#x5B58;&#x50A8;&#x65B9;&#x5F0F;&#x3002;&#x65B9;&#x6CD5;&#x662F;&#x91C7;&#x7528;&#x5206;&#x5757;&#x7684;&#x65B9;&#x5F0F;&#x3002;</p>
<blockquote>
<p><img src="vllm.assets/1.gif" alt="1"></p>
</blockquote>
<p>&#x5F53;&#x539F;&#x6587;&#x4E3A; Alan Turing is a|computer scientist and mathmatician|renowned for ...</p>
<p>&#x5176;&#x88AB;&#x5206;&#x6210;&#x4E09;&#x4E2A;&#x5757;&#x6765;&#x5B8C;&#x6210;&#xFF0C;&#x8FD9;&#x4E09;&#x4E2A;&#x5757;&#x7684;&#x7269;&#x7406;&#x5185;&#x5B58;&#x4E0D;&#x4E00;&#x6837;&#x3002;</p>
<p>&#x8BA1;&#x7B97;&#x65B9;&#x5F0F;&#x4E3A;</p>
<blockquote>
<p><img src="vllm.assets/7.png" alt="7"></p>
</blockquote>
<p>&#x8FD9;&#x6837;&#x5C31;&#x53EF;&#x4EE5;&#x51CF;&#x5C11;KV Cache&#x7684;&#x6D6A;&#x8D39;&#xFF0C;&#x6700;&#x591A;&#x6D6A;&#x8D39;3&#x4E2A;&#x7A7A;&#x3002;&#xFF08;&#x8FD9;&#x4E5F;&#x662F;&#x4E3A;&#x4EC0;&#x4E48;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x5F15;&#x5165;&#x5206;&#x9875;&#x673A;&#x5236;&#xFF09;</p>
<blockquote>
<p><img src="vllm.assets/2.gif" alt="2"></p>
</blockquote>
<p>&#x5E76;&#x4E14;&#x6839;&#x636E;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x7684;<strong>&#x5199;&#x65F6;&#x5171;&#x4EAB;&#x673A;&#x5236;</strong>&#xFF0C;PagedAttention &#x53EF;&#x4EE5;&#x5F53;&#x4EA7;&#x751F;&#x591A;&#x4E2A;&#x7ED3;&#x679C;&#x65F6;&#xFF0C;&#x5C06;&#x4E0B;&#x56FE;&#x4E2D;&#x7684;intelligence is&#x590D;&#x5236;&#x5230;&#x591A;&#x4E2A;&#x5757;&#x4E0A;&#x3002;</p>
<blockquote>
<p><img src="vllm.assets/3.gif" alt="3"></p>
</blockquote>
<p>&#x8FD8;&#x91C7;&#x7528;&#x4E86;<strong>&#x675F;&#x641C;&#x7D22;&#x673A;&#x5236;</strong></p>
<blockquote>
<p><img src="vllm.assets/8.png" alt="8"></p>
<p>&#x8FD9;&#x662F;&#x4E00;&#x4E2A;&#x675F;&#x5BBD;&#x4E3A;2&#x7684;<a href="https://zh.d2l.ai/chapter_recurrent-modern/beam-search.html" target="_blank">&#x675F;&#x641C;&#x7D22;&#x6837;&#x4F8B;</a>&#x3002;&#x9009;&#x62E9;&#x6700;&#x5927;&#x7684;&#x4E24;&#x4E2A;&#x3002;</p>
<p><img src="vllm.assets/9.png" alt="9"></p>
<p>&#x5728;vLLM&#x4E2D;&#xFF0C;&#x5219;&#x662F;&#x8FD9;&#x79CD;&#x6548;&#x679C;&#xFF0C;&#x8DDF;&#x4E0A;&#x56FE;&#x975E;&#x5E38;&#x76F8;&#x4F3C;&#x3002;</p>
</blockquote>
<p>vLLM&#x4E5F;&#x8003;&#x8651;&#x5230;<strong>&#x5171;&#x4EAB;&#x524D;&#x7F00;</strong>&#x7684;&#x95EE;&#x9898;&#x3002;</p>
<blockquote>
<p><img src="vllm.assets/10.png" alt="10"></p>
</blockquote>
<p>&#x5BF9;&#x4E8E;&#x6B64;&#x7C7B;&#x5E94;&#x7528;vLLM&#x4F1A;&#x5171;&#x4EAB;&#x524D;&#x7F00;&#xFF0C;&#x53EA;&#x5728;Task Input&#x4E0A;&#x6709;&#x5DEE;&#x5F02;&#x3002;&#x5176;&#x5B9E;&#x5C31;&#x662F;&#x524D;&#x6587;&#x7684;&#x5206;&#x9875;&#x673A;&#x5236;&#x3002;</p>
<h3 id="scheduling-and-preemption">Scheduling and Preemption</h3>
<p>&#x91C7;&#x7528;<strong>first-come-first-serve</strong> (<strong>FCFS</strong>)&#xFF0C;&#x5148;&#x6765;&#x5148;&#x670D;&#x52A1;&#x3002;</p>
<p>&#x95EE;&#x9898;&#xFF1A;</p>
<ul>
<li>&#x5047;&#x5982;&#x6EE1;&#x4E86;&#xFF0C;&#x5E94;&#x8BE5;&#x9A71;&#x9010;&#x54EA;&#x4E9B;&#x5757;<ul>
<li>transformer&#x7279;&#x6027;&#x2192;&#x540C;&#x4E00;&#x4E2A;&#x5E8F;&#x5217;&#x7684;&#x5757;&#x8981;&#x4E48;&#x4E00;&#x8D77;&#x88AB;&#x9A71;&#x9010;&#xFF0C;&#x8981;&#x4E48;&#x4E00;&#x8D77;&#x7559;&#x4E0B;&#x3002;</li>
<li>&#x5047;&#x5982;&#x6709;&#x675F;&#x641C;&#x7D22;&#xFF0C;&#x5176;&#x5C06;&#x5E8F;&#x5217;&#x5206;&#x6210;&#x4E86;&#x5F88;&#x591A;&#x7EC4;&#xFF0C;&#x4E14;&#x5B58;&#x5728;&#x5185;&#x5B58;&#x5171;&#x4EAB;&#xFF0C;&#x7EC4;&#x5185;&#x6240;&#x6709;&#x5E8F;&#x5217;&#x7684;&#x5757;&#x540C;&#x65F6;&#x88AB;&#x8C03;&#x5EA6;&#x3002;</li>
</ul>
</li>
<li>&#x5047;&#x5982;&#x4ECD;&#x88AB;&#x9700;&#x8981;&#xFF0C;&#x5982;&#x4F55;&#x6062;&#x590D;&#x88AB;&#x9A71;&#x9010;&#x7684;&#x5757;&#x3002;<ul>
<li>&#x4EA4;&#x6362;&#x3002;&#x653E;&#x5230;CPU&#x5185;&#x5B58;&#x4E2D;&#x3002;</li>
<li>&#x91CD;&#x65B0;&#x8BA1;&#x7B97;&#x3002;&#x56E0;&#x4E3A;&#x89E3;&#x7801;&#x65F6;&#x7684;&#x4EE4;&#x724C;&#x548C;&#x7528;&#x6237;&#x63D0;&#x793A;&#x94FE;&#x63A5;&#x8D77;&#x6765;&#x6210;&#x4E3A;&#x65B0;&#x7684;&#x63D0;&#x793A;&#xFF0C;&#x4E00;&#x6B21;&#x5C31;&#x53EF;&#x4EE5;&#x751F;&#x6210;KV Cache&#xFF0C;&#x6240;&#x4EE5;&#x4F1A;&#x6BD4;&#x4E4B;&#x524D;&#x7B97;&#x7684;&#x5757;&#x3002;</li>
</ul>
</li>
</ul>
<h3 id="distributed-execution">Distributed Execution</h3>
<blockquote>
<p>Specifically, the attention operator is split on the attention head dimension, each SPMD process takes care of a subset of attention heads in multi-head attention.</p>
</blockquote>
<p>VLLM&#x662F;&#x5C06;&#x6CE8;&#x610F;&#x529B;&#x7B97;&#x5B50;&#x5728;&#x6CE8;&#x610F;&#x529B;&#x5934;&#x7EF4;&#x5EA6;&#x4E0A;&#x8FDB;&#x884C;&#x5206;&#x5272;&#x3002;</p>
<p>&#x4E14;&#x7531;&#x4E8E;&#x6BCF;&#x4E2A;&#x6A21;&#x578B;&#x7684;&#x5206;&#x7247;&#x5904;&#x7406;&#x76F8;&#x540C;&#x7684;&#x8F93;&#x5165;&#x6807;&#x8BB0;&#x96C6;&#xFF0C;&#x6240;&#x4EE5;vLLM&#x91C7;&#x7528;&#x7684;&#x662F;&#x96C6;&#x4E2D;&#x5F0F;&#x8C03;&#x5EA6;&#xFF0C;&#x4E00;&#x4E2A;Scheduler&#x3002;</p>
<blockquote>
<p>This common mapping allows GPU workers to execute the model with the physical blocks provided by the scheduler for each input request. Although each GPU worker has the same physical block IDs, <strong>a worker only stores a portion of the KV cache for its corresponding attention heads.</strong></p>
</blockquote>
<p>&#x7531;&#x4E8E;&#x5934;&#x4E0D;&#x540C;&#xFF0C;&#x7BA1;&#x7406;&#x8D77;&#x6765;&#x662F;&#x4E00;&#x6837;&#x7684;&#xFF0C;&#x4F46;&#x662F;&#x6570;&#x636E;&#x662F;&#x4E0D;&#x4E00;&#x6837;&#x7684;&#x3002;</p>
<blockquote>
<p><img src="vllm.assets/11.png" alt="11"></p>
<ol>
<li><p>In each step, the scheduler first prepares the message with input token IDs for each request in the batch, as well as the block table for each request. </p>
</li>
<li><p>Next, the scheduler broadcasts this control message to the GPU workers. </p>
</li>
<li>Then, the GPU workers start to execute the model with the input token IDs. </li>
<li>In the attention layers, the GPU workers read the KV cache according to the block table in the control message. </li>
<li>During execution, the GPU workers synchronize the intermediate results with the all-reduce communication primitive without the coordination of the scheduler, as in [47]. </li>
<li>In the end, the GPU workers send the sampled tokens of this iteration back to the scheduler. </li>
</ol>
</blockquote>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="./" class="navigation navigation-prev " aria-label="Previous page: SOSP 2023">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="../OSDI 2022/" class="navigation navigation-next " aria-label="Next page: OSDI 2022">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Vllm","level":"3.9.1","depth":2,"next":{"title":"OSDI 2022","level":"3.10","depth":1,"path":"Paper Reading Notes/OSDI 2022/index.md","ref":"Paper Reading Notes/OSDI 2022/index.md","articles":[{"title":"Orca","level":"3.10.1","depth":2,"path":"Paper Reading Notes/OSDI 2022/Orca.md","ref":"Paper Reading Notes/OSDI 2022/Orca.md","articles":[]}]},"previous":{"title":"SOSP 2023","level":"3.9","depth":1,"path":"Paper Reading Notes/SOSP 2023/index.md","ref":"Paper Reading Notes/SOSP 2023/index.md","articles":[{"title":"Vllm","level":"3.9.1","depth":2,"path":"Paper Reading Notes/SOSP 2023/vllm.md","ref":"Paper Reading Notes/SOSP 2023/vllm.md","articles":[]}]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":["hide-element","back-to-top-button","chapter-fold","code","splitter","katex","expandable-chapters-small"],"pluginsConfig":{"chapter-fold":{},"splitter":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"code":{"copyButtons":true},"hide-element":{"elements":[".gitbook-link"]},"katex":{},"fontsettings":{"theme":"white","family":"sans","size":2},"highlight":{},"back-to-top-button":{},"expandable-chapters-small":{},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"Introduction.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"Paper Reading Notes/SOSP 2023/vllm.md","mtime":"2024-12-02T02:35:31.786Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2024-12-02T02:36:07.078Z"},"basePath":"../..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../../gitbook/gitbook.js"></script>
    <script src="../../gitbook/theme.js"></script>
    
        
        <script src="../../gitbook/gitbook-plugin-hide-element/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-back-to-top-button/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-chapter-fold/chapter-fold.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-code/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-splitter/splitter.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-expandable-chapters-small/expandable-chapters-small.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

